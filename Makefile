#/*****************************************************************************************************************/

NAME=observerly-birpc

#/*****************************************************************************************************************/

run: buff diff migrate
	BIRPC_DSN="root:pass@tcp(127.0.0.1:3306)/observerly?charset=utf8mb4&parseTime=True&loc=Local" go run cmd/api/main.go

#/*****************************************************************************************************************/

buff:
	buf generate

#/*****************************************************************************************************************/

migrate:
	atlas schema apply \
	--url "mysql://user:password@db:3306/observerly" \
	--to "file://migrations" \
	--dev-url "mysql://user:password@db:3306/observerly" \
	--auto-approve

#/*****************************************************************************************************************/

clean:
	atlas schema clean \
	--url "mysql://user:password@db:3306/observerly"

#/*****************************************************************************************************************/

diff: clean
	atlas migrate diff --env gorm

#/*****************************************************************************************************************/

populate:
	@echo "Populating the database..."

#/*****************************************************************************************************************/

test:
	@echo "Testing..."
	go test -v ./...
	@echo "Testing complete."

#/*****************************************************************************************************************/

# Format the application code
format:
	@echo "Formatting..."
	@go fmt ./...
	@echo "Formatting complete."

#/*****************************************************************************************************************/

# Vet the application code
vet:
	@echo "Vetting..."
	@go vet ./...
	@echo "Vetting complete."

#/*****************************************************************************************************************/

# Lint the application code
lint:
	@echo "Linting..."
	@staticcheck ./...
	@echo "Linting complete."

#/*****************************************************************************************************************/

# Run GoCritic
critic: 
	@echo "Running Critic..."
	@gocritic check ./...
	@echo "Critic complete."

#/*****************************************************************************************************************/